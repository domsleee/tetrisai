
#pragma once
#include "src/common/Weighting.hpp"
#include "src/common/common.hpp"
#include "src/pso/ClientApi.hpp"
#include "src/shared/MoveFinder/MoveFinderFSM.h"
#include "src/shared/MoveEvaluator/MoveEvaluatorTetrisReady.hpp"


const int LINE_TRANSITION = 90;
const int LINE_ON_LEVEL_19 = 130;
const int LINE_ON_LEVEL_29 = 230;

std::string best18_tetris_ready = "[-0.9981266671825644 6.314235664122202 9.218841471366666 0.27802110735477736 -4.1780630417598195 7.433743023240332 8.34877823356098 1.8788685887367613 -0.8499180634596748 -1.8078460542586594 7.642165019678991 -4.116700896835317 4.954418944561089 -12.37120499004913 -11.044493568377911 1.8097163771233449 -1.0832040443509103 0]";
std::string best19_tetris_ready = "[-3.2059589083681987 13.934306954104752 8.582812512620382 4.620125316991949 0.11424426376260488 9.602892153464865 5.762967452283011 -4.925621845548844 8.387695035138393 15.852273679801971 14.366739402700002 -5.93360039853766 -14.269952629896206 -12.829433871203618 -7.237374311782248 1.219322796666706 1.4678825466817012 9.907617075381381]";

std::string best18 = "[-0.9981266671825644 6.314235664122202 9.218841471366666 0.27802110735477736 -4.1780630417598195 7.433743023240332 8.34877823356098 1.8788685887367613 -0.8499180634596748 -1.8078460542586594 7.642165019678991 -4.116700896835317 4.954418944561089 -12.37120499004913 -11.044493568377911 1.8097163771233449 -1.0832040443509103]";
std::string best19 = "[-14.89103037780527 6.1859328293901985 3.1475886283096397 4.549423856563027 6.4739513866334395 7.16934616046338 19.220915906005704 -1.5353264906442918 8.606784031245795 4.760696336241033 13.769672756691616 -2.0002884453295877 -2.4896370025512127 -8.345237667961287 -13.478496677643442 1.0396980163363931 2.178578911705224]";

auto w1 = WeightingFn::readFromString(best18_tetris_ready);
auto w2 = WeightingFn::readFromString(best19_tetris_ready);

auto getMeMfPair(int num_lines) {
  auto me1 = MoveEvaluatorTetrisReady(w1);
  auto me2 = MoveEvaluatorTetrisReady(w2);
  //auto me1 = MoveEvaluatorAdapter(MoveEvaluator(), w1);
  //auto me2 = MoveEvaluatorAdapter(MoveEvaluator(), w2);
  
  auto mf1 = MoveFinderFSM();
  auto mf2 = MoveFinderFSM();
  auto mf3 = MoveFinderFSM();
  mf2.setMaxDropRem(2);
  mf3.setMaxDropRem(1);

  /*if (num_lines >= LINE_ON_LEVEL_29) {
    return std::pair(me2, mf3);
  }*/
  if (num_lines >= LINE_ON_LEVEL_19) {
    return std::pair(me2, mf2);
  }
  else if (num_lines >= LINE_TRANSITION) {
    return std::pair(me2, mf1);
  }
  return std::pair(me1, mf1);
}
